<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° ArkLegendsPVE Sent Points Logs ‚ö°</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Montserrat:wght@600;800&display=swap" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Montserrat:wght=600;800&display=swap');

        /* NEW Sleek Modern Blue Palette (with Log Colors) */
        :root {
            --modern-darkest: #121212;
            --modern-dark-bg: #1e1e1e;
            --modern-accent-blue: #00AEEF;
            --modern-light-blue: #66CCFF;
            --modern-text-light: #E0E0E0;
            --modern-shadow-glow: rgba(0, 174, 239, 0.4);
            --modern-input-bg: #2b2b2b;
            --modern-border: #3A3A3A;
            --modern-secondary-text: #B0B0B0;

            /* Log Entry Colors */
            --log-added-green: #2ECC71; /* Green */
            --log-deducted-red: #E74C3C; /* Red */
            --log-adjusted-blue: #3498DB; /* Blue */
            --log-other-pink: #FF69B4; /* Pink */

            --log-added-color: var(--log-added-green);
            --log-deducted-color: var(--log-deducted-red);
            --log-adjusted-color: var(--log-adjusted-blue);
            --log-other-color: var(--log-other-pink);
        }
        
        /* --- DEFAULT: DESKTOP STYLES --- */

        body {
            font-family: 'Roboto', sans-serif;
            padding: 30px; 
            background: var(--modern-darkest);
            min-height: 100vh;
            margin: 0;
            color: var(--modern-text-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden; 
            line-height: 1.6; 
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100px;
            padding: 0 10px;
            box-sizing: border-box;
        }

        h1 {
            font-family: 'Montserrat', sans-serif;
            color: var(--modern-text-light);
            text-shadow: 0 0 15px var(--modern-shadow-glow);
            font-size: 3.5em;
            letter-spacing: 5px;
            margin: 0;
            position: relative;
            z-index: 1;
            white-space: nowrap;
            text-transform: uppercase;
        }

        h1::after {
            content: '';
            display: block;
            width: 100%;
            height: 3px;
            background: var(--modern-accent-blue);
            margin: 10px auto 0;
            border-radius: 2px;
            box-shadow: 0 0 10px var(--modern-shadow-glow);
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .input-form, .list-container {
            min-width: 350px;
            padding: 40px;
            border-radius: 8px;
            background-color: var(--modern-dark-bg);
            border: 1px solid var(--modern-border);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5), 0 0 10px rgba(0, 174, 239, 0.1);
            transition: all 0.3s ease-in-out;
            box-sizing: border-box;
            z-index: 1;
        }

        .input-form {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .list-container {
            flex: 2;
            min-width: 700px;
        }

        h2 {
            font-family: 'Montserrat', sans-serif;
            color: var(--modern-accent-blue);
            border-bottom: 3px solid var(--modern-border);
            padding-bottom: 12px;
            margin-top: 0;
            font-size: 1.8em;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 174, 239, 0.5);
            text-transform: uppercase;
            align-self: stretch;
            text-align: center; 
        }

        /* --- Input and Select Styling: Desktop --- */
        input[type="text"],
        #miscReasonInput,
        #otherActionInput,
        #nameId,
        #amountInput,
        #whatFor,
        #actionSelect,
        #searchBar {
            font-family: 'Roboto', sans-serif;
            padding: 15px;
            margin: 12px 0;
            border-radius: 4px;
            font-size: 1.1em;
            background-color: var(--modern-input-bg);
            color: var(--modern-text-light);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.6);
            transition: border-color 0.2s, box-shadow 0.2s;
            border: 1px solid var(--modern-border);
            align-self: stretch;
            box-sizing: border-box;
        }

        #nameId, #amountInput, #whatFor, #actionSelect {
            border: 1px solid var(--modern-accent-blue);
            box-shadow: 0 0 5px rgba(0, 174, 239, 0.3), inset 0 1px 3px rgba(0, 0, 0, 0.6);
        }

        #whatFor, #actionSelect {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23E0E0E0%22%20d%3D%22M287%20197.35L146.2%2056.65L5.4%20197.35z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat, repeat;
            background-position: right .7em top 50%, 0 0;
            background-size: .65em auto, 100%;
            cursor: pointer;
        }
        
        /* --- ACTION TYPE DROPDOWN COLORING --- */
        #actionSelect option[value="Added"] {
            color: var(--log-added-green);
            font-weight: bold;
        }
        #actionSelect option[value="Deducted"] {
            color: var(--log-deducted-red);
            font-weight: bold;
        }
        #actionSelect option[value="Balance Adjusted"] {
            color: var(--log-adjusted-blue);
            font-weight: bold;
        }
        #actionSelect option[value="Other Action"] {
            color: var(--log-other-pink);
            font-weight: bold;
        }
        #actionSelect option[disabled] {
            color: var(--modern-secondary-text); 
            font-weight: normal;
        }

        /* --- Button Styles: Desktop --- */
        button {
            font-family: 'Montserrat', sans-serif;
            background: var(--modern-accent-blue);
            color: var(--modern-darkest);
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 700;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            transition: all 0.2s ease-in-out;
            text-transform: uppercase;
            min-width: 200px;
            max-width: 90%;
            width: 90%;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            width: 100%;
            margin-top: 30px;
            gap: 12px;
            align-items: center;
        }

        .button-group button {
            margin-top: 0;
            width: 90%;
            max-width: 350px;
        }

        #addToListBtn {
            padding: 15px 35px;
            font-size: 1.3em;
            border: 2px solid var(--modern-text-light);
        }
        
        /* --- DANGER & INFO BUTTON STYLING (Desktop) --- */
        .danger-button { background: #E74C3C; border: 2px solid #C0392B; color: var(--modern-text-light); }
        .danger-button:hover { background: #C0392B; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.5); }
        .info-button { background: #2C3E50; border: 2px solid #34495E; color: var(--modern-text-light); }
        .info-button:hover { background: #34495E; box-shadow: 0 4px 15px rgba(44, 62, 80, 0.5); }
        .cancel-button { background: #505050; border: 2px solid #333; color: var(--modern-text-light); }
        .cancel-button:hover { background: #333; }

        /* --- POINTS REFERENCE LAYOUT: Desktop --- */
        .points-reference {
            margin-top: 30px;
            align-self: stretch;
            padding: 15px;
            background-color: #242424;
            border-radius: 4px;
            border: 1px dashed var(--modern-border);
            font-size: 0.9em;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .reference-section {
            padding-top: 10px;
            min-width: 250px;
            flex-grow: 1;
            flex-basis: 0;
        }

        .reference-section h3 {
            text-align: center;
        }
        
        .reference-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        /* JAZZED UP AWARDS STYLES */
        .points-list-item {
            font-size: 1.0em;
            padding: 8px 0;
            border-bottom: 1px dashed var(--modern-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .points-list-item:last-child {
            border-bottom: none;
        }

        .points-list-item strong {
            color: var(--modern-light-blue);
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            margin-left: 10px;
        }

        /* COLOR KEY SWATCHES */
        .color-swatch {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
            border: 1px solid;
        }

        .swatch-added { background-color: var(--log-added-color); border-color: var(--log-added-color); }
        .swatch-deducted { background-color: var(--log-deducted-color); border-color: var(--log-deducted-color); }
        .swatch-adjusted { background-color: var(--log-adjusted-color); border-color: var(--log-adjusted-color); }
        .swatch-other { background-color: var(--log-other-color); border-color: var(--log-other-color); }


        /* --- LOG ENTRIES: MAX VISIBILITY REDESIGN (DESKTOP) --- */
        #entryList {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .list-utility-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            margin-bottom: 10px;
            gap: 10px;
        }
        
        #deleteSelectedBtn {
            flex-grow: 1;
            max-width: 45%;
            padding: 10px 15px;
            font-size: 0.9em;
        }

        #entryList li {
            background: var(--modern-input-bg);
            margin: 8px 0; 
            padding: 12px; 
            border-radius: 4px;
            border: 1px solid; 
            font-size: 0.95em; 
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            cursor: pointer; /* Indicate item is clickable */
            transition: background-color 0.2s, box-shadow 0.2s;
        }
        
        /* Highlight row on selection */
        #entryList li.selected {
            background-color: #34495E; 
            box-shadow: 0 0 10px rgba(0, 174, 239, 0.4); /* Glow effect on selection */
        }
        #entryList li:hover:not(.selected) {
            background-color: #282828;
        }

        .log-content {
            /* Desktop: Uses Flexbox with wrap for clarity */
            display: flex;
            flex-wrap: wrap;
            width: 100%;
            align-items: flex-start;
            padding-bottom: 10px;
            border-bottom: 1px dashed var(--modern-border);
            margin-bottom: 5px; 
            gap: 10px 30px;
        }

        .log-segment {
            padding: 0;
            line-height: 1.4;
            flex-basis: auto; 
            flex-grow: 1; 
        }
        
        .log-segment strong {
            font-weight: 700; 
            color: var(--modern-secondary-text); 
            margin-right: 5px;
            display: inline-block;
            min-width: 60px; 
        }
        
        /* Desktop Segment Sizes: Giving them clear breakpoints */
        .log-segment-name { 
            flex-basis: 35%; 
            font-weight: 700; 
            color: var(--modern-accent-blue); 
            min-width: 250px;
        }
        .log-segment-action {
            flex-basis: 25%;
            min-width: 180px;
        }
        .log-segment-amount { 
            flex-basis: 25%;
            min-width: 150px;
            font-weight: 900; 
            text-shadow: 0 0 5px rgba(102, 204, 255, 0.4);
        }
        .log-segment-reason { 
            flex-basis: 100%; 
            font-size: 0.9em;
            margin-top: 5px; 
        }


        /* Specific coloring for the Amount based on action class */
        #entryList li.added .log-segment-amount { color: var(--log-added-color); }
        #entryList li.deducted .log-segment-amount { color: var(--log-deducted-color); }
        #entryList li.adjusted .log-segment-amount { color: var(--log-adjusted-color); }
        #entryList li.other .log-segment-amount { color: var(--log-other-color); }


        .log-timestamp {
            font-family: 'Roboto', sans-serif;
            font-size: 0.75em; 
            color: #AAAAAA;
            display: block;
            padding: 1px 0 0 0; 
            width: 100%;
            text-align: right;
        }

        /* --- Log Color Borders --- */
        #entryList li.added { border-color: var(--log-added-color); }
        #entryList li.deducted { border-color: var(--log-deducted-color); }
        #entryList li.adjusted { border-color: var(--log-adjusted-color); }
        #entryList li.other { border-color: var(--log-other-color); }
        
        /* --- DELETE BUTTON STYLES (now dedicated list button) --- */
        #deleteSelectedBtn {
            background: #E74C3C; 
            color: var(--modern-text-light);
            border: 1px solid #C0392B;
        }
        #deleteSelectedBtn:hover {
            background: #C0392B;
            box-shadow: 0 0 5px rgba(231, 76, 60, 0.5);
        }


        /* --- MODAL STYLES (New) --- */
        #deleteConfirmationModal {
            display: none; 
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            padding-top: 60px;
        }

        .modal-content {
            background-color: var(--modern-dark-bg);
            margin: 5% auto;
            padding: 30px;
            border: 2px solid var(--log-deducted-color);
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-content h3 {
            color: var(--log-deducted-color);
            border-bottom: 2px solid var(--modern-border);
            padding-bottom: 10px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
        }
        
        .modal-body {
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .modal-checkbox-group {
            display: flex;
            align-items: center;
            margin: 20px 0;
        }

        .modal-checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            accent-color: var(--log-deducted-color);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-footer button {
            width: auto;
            min-width: 100px;
            padding: 10px 20px;
        }
        /* End MODAL STYLES */


        /* --- RESPONSIVE ADJUSTMENTS (MOBILE: MAX VISIBILITY) --- */
        
        @media (max-width: 1100px) {
            .input-form, .list-container {
                flex: 1 1 100%;
                min-width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 15px; 
            }

            h1 {
                font-size: 2.2em; 
                letter-spacing: 2px;
                white-space: normal;
                line-height: 1.2;
            }

            .input-form, .list-container {
                padding: 20px;
            }
            
            /* List utility button */
            .list-utility-group {
                flex-direction: column;
                gap: 10px;
            }
            #deleteSelectedBtn {
                max-width: 100%;
                width: 100%;
            }
            
            /* Modal mobile size */
            .modal-content {
                width: 90%;
            }
            
            /* --- LOG ENTRY MOBILE FIXES: Stacked for Clarity --- */
            
            #entryList li {
                padding: 10px; 
            }
            
            .log-content {
                flex-direction: column; 
                gap: 2px;
                border-bottom: 1px dashed var(--modern-border); 
            }
            
            .log-segment {
                width: 100%; 
                white-space: normal;
                overflow: visible;
                display: flex; 
                justify-content: flex-start;
                align-items: flex-start;
                padding: 2px 0;
            }
            
            .log-segment strong {
                min-width: 80px; 
                flex-shrink: 0;
            }

            /* Timestamp always left-aligned */
            .log-timestamp {
                text-align: left;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>
            ArkLegendsPVE Sent Points Logs
        </h1>
    </header>

    <div class="container">
        <div class="input-form">
            <h2>‚ûï Add Points Log</h2>
            <input type="text" id="nameId" placeholder="Player Name/EOS ID">

            <select id="actionSelect">
                <option value="" disabled selected>--- Select Action Type ---</option>
                <option value="Added">Added</option>
                <option value="Deducted">Deducted</option>
                <option value="Balance Adjusted">Balance Adjusted</option>
                <option value="Other Action">Other Action</option>
            </select>

            <input type="text" id="otherActionInput" placeholder="Specify Other Action" style="display:none;">

            <input type="text" id="amountInput" placeholder="Amount (e.g., 5000)">

            <select id="whatFor">
                <option value="" disabled selected>--- Select Reason for Points ---</option>
                <option value="Discord Boost (1k points)">Discord boost (1k points)</option>
                <option value="Server Donation (1k points)">Server donation (1k points)</option>
                <option value="Mod Developer Donation (1k points)">Mod developer donation (1k points)</option>
                <option value="1st on Voting Leaderboard (5k points)">1st on Voting Leaderboard (5k points)</option>
                <option value="Mee6 Lvl 10 (2k points)">Mee6 Lvl 10 (2k points)</option>
                <option value="Mee6 Lvl 15 (3k points)">Mee6 Lvl 15 (3k points)</option>
                <option value="Mee6 Lvl 20 (4k points)">Mee6 Lvl 20 (4k points)</option>
                <option value="1st in Accessories Leaderboard (5k points)">1st in Accessories Leaderboard (5k points)</option>
                <option value="2nd in Accessories Leaderboard (3k points)">2nd in Accessories Leaderboard (3k points)</option>
                <option value="3rd in Accessories Leaderboard (1k points)">3rd in Accessories Leaderboard (1k points)</option>
                <option value="Completing the Feedback Survey (2.5k)">Completing the feedback survey (2.5k)</option>
                <option value="Bought in another player (1k)">Bought in another player (1k)</option>
                <option value="Shop Refund">Shop refund</option>
                <option value="Misc">Misc</option>
            </select>

            <input type="text" id="miscReasonInput" placeholder="Specify Misc Reason" style="display:none;">

            <div class="button-group">
                <button id="addToListBtn">Save to Log</button>
                <button id="downloadLogBtn">Download Log (.txt)</button>
                <button id="clearLogLocalBtn" class="info-button">Clear Local Display (Server Data Stays)</button>
                <button id="clearLogBtn" class="danger-button">Clear ALL Entries (Server & Local)</button>
            </div>

            <div class="points-reference">
                <div class="reference-section standard-awards">
                    <h3>‚≠ê Standard Point Awards Reference</h3>
                    <ul class="points-list">
                        <li class="points-list-item">
                            <span>üöÄ Discord Boost:</span>
                            <strong>1,000 pts</strong>
                        </li>
                        <li class="points-list-item">
                            <span>üíé Server/Mod Donation:</span>
                            <strong>1,000 pts</strong>
                        </li>
                        <li class="points-list-item">
                            <span>üó≥Ô∏è Voting Leaderboard 1st:</span>
                            <strong>5,000 pts</strong>
                        </li>
                        <li class="points-list-item">
                            <span>üèÖ Mee6 Lvl 10:</span>
                            <strong>2,000 pts</strong>
                        </li>
                        <li class="points-list-item">
                            <span>üèÜ Mee6 Lvl 15:</span>
                            <strong>3,000 pts</strong>
                        </li>
                        <li class="points-list-item">
                            <span>üëë Mee6 Lvl 20:</span>
                            <strong>4,000 pts</strong>
                        </li>
                        <li class="points-list-item">
                            <span>ü•á Accessories 1st Place:</span>
                            <strong>5,000 pts</strong>
                        </li>
                        <li class="points-list-item">
                            <span>ü•à Accessories 2nd Place:</span>
                            <strong>3,000 pts</strong>
                        </li>
                        <li class="points-list-item">
                            <span>ü•â Accessories 3rd Place:</span>
                            <strong>1,000 pts</strong>
                        </li>
                        <li class="points-list-item">
                            <span>üìù Feedback Survey:</span>
                            <strong>2,500 pts</strong>
                        </li>
                        <li class="points-list-item">
                            <span>ü§ù Bought in New Player:</span>
                            <strong>1,000 pts</strong>
                        </li>
                        <li class="points-list-item">
                            <span>üîÑ Shop Refund:</span>
                            <strong>*Variable*</strong>
                        </li>
                    </ul>
                </div>

                <div class="reference-section color-key">
                    <h3>üé® Log Color Key</h3>
                    <ul>
                        <li><span class="color-swatch swatch-added"></span> <strong>Green:</strong> Points **Added** (Credit)</li>
                        <li><span class="color-swatch swatch-deducted"></span> <strong>Red:</strong> Points **Deducted** (Debit)</li>
                        <li><span class="color-swatch swatch-adjusted"></span> <strong>Blue:</strong> **Balance Adjusted** (Correction)</li>
                        <li><span class="color-swatch swatch-other"></span> <strong>Pink:</strong> **Other Action** (Non-Point Related)</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="list-container">
            <h2>üìú Points History</h2> 
            <input type="text" id="searchBar" placeholder="üîç Search Player, Action, or Reason...">
            
            <div class="list-utility-group">
                 <button id="deleteSelectedBtn" class="danger-button" disabled>üóëÔ∏è Delete Selected Entries</button>
            </div>

            <ul id="entryList">
            </ul>
        </div>
    </div>

    <div id="deleteConfirmationModal" style="display: none;">
        <div class="modal-content">
            <h3><span style="color:var(--log-deducted-color);">‚ö†Ô∏è CONFIRM DELETE ACTION</span></h3>
            <div class="modal-body">
                <p>You have selected <strong id="entriesToDeleteCount">0</strong> log entries for deletion.</p>
                <p>This action is **PERMANENT** and cannot be undone on the server.</p>
                
                <div class="modal-checkbox-group">
                    <input type="checkbox" id="deleteConfirmCheckbox">
                    <label for="deleteConfirmCheckbox" style="color:var(--log-deducted-color);">I understand and confirm that these entries will be permanently deleted.</label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="cancel-button" onclick="closeModal()">Cancel</button>
                <button class="danger-button" id="modalConfirmDeleteBtn" disabled onclick="confirmDelete()">Permanently Delete</button>
            </div>
        </div>
    </div>
    <script>
        // *******************************************************************
        // ***‚ö†Ô∏è CONFIGURATION: Replace these placeholders for server sync! ***
        // *******************************************************************
        // BIN_ID has been updated with your new ID.
        // You MUST replace the SECRET_KEY placeholder below with your JSONBin.io Master Key.
        const BIN_ID = "6920a528ae596e708f67f685";
        const SECRET_KEY = "$2a$10$Y7RyMSyB.GU67ZJdEbqQuuwdj7UJhht8mdy.Ytjf1CJHThjMoj0SW"; // <--- YOU MUST REPLACE THIS!
        const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
        // *******************************************************************

        // --- PASSWORD SETTING (for server-wide clear) ---
        const CLEAR_PASSWORD = "legends";
        // ------------------------------------------------

        const nameIdInput = document.getElementById('nameId');
        const actionSelect = document.getElementById('actionSelect');
        const otherActionInput = document.getElementById('otherActionInput');
        const amountInput = document.getElementById('amountInput');
        const whatForInput = document.getElementById('whatFor');
        const miscReasonInput = document.getElementById('miscReasonInput');
        const addToListBtn = document.getElementById('addToListBtn');
        const entryList = document.getElementById('entryList');
        const searchBar = document.getElementById('searchBar');
        const downloadLogBtn = document.getElementById('downloadLogBtn');
        const clearLogBtn = document.getElementById('clearLogBtn');
        const clearLogLocalBtn = document.getElementById('clearLogLocalBtn');
        const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');
        
        // Modal Elements
        const modal = document.getElementById('deleteConfirmationModal');
        const entriesCountDisplay = document.getElementById('entriesToDeleteCount');
        const deleteCheckbox = document.getElementById('deleteConfirmCheckbox');
        const modalConfirmButton = document.getElementById('modalConfirmDeleteBtn');


        let logEntries = [];

        // --- PLACEHOLDER DEFINITION (Used for saves/clears when log is empty) ---
        const PLACEHOLDER_ENTRY = {
            text: "PLACEHOLDER",
            html: "",
            search: "ignore placeholder",
            timestamp: Date.now(),
            actionClass: "other"
        };
        // --------------------------------------------------------------------------

        // --- MODAL FUNCTIONS ---

        function showDeleteConfirmation() {
            const selectedCount = entryList.querySelectorAll('li.selected').length;
            if (selectedCount === 0) {
                alert("No entries selected for deletion. Click a log entry to select it.");
                return;
            }

            entriesCountDisplay.textContent = selectedCount;
            deleteCheckbox.checked = false; // Reset checkbox state
            modalConfirmButton.disabled = true; // Button disabled initially
            modal.style.display = 'block';
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        function toggleModalConfirmButton() {
            modalConfirmButton.disabled = !deleteCheckbox.checked;
        }

        async function confirmDelete() {
            if (deleteCheckbox.checked) {
                closeModal();
                await deleteSelectedEntries();
            } else {
                alert("Please check the confirmation box to proceed with permanent deletion.");
            }
        }

        // --- JSONBIN Functions (Unchanged) ---
        async function loadEntries() {
            if (SECRET_KEY === "YOUR_JSONBIN_SECRET_KEY_HERE") {
                console.error("JSONBin Secret Key is not set. Log will not save or load from server.");
                return;
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: { 'X-Master-Key': SECRET_KEY }
                });
                if (!response.ok) {
                    const errorDetails = await response.text();
                    throw new Error(`HTTP error! Status: ${response.status}. Details: ${errorDetails}`);
                }
                const data = await response.json();

                const records = data.record || data;
                logEntries = Array.isArray(records) ? records.filter(entry => entry.text !== "PLACEHOLDER") : [];
                logEntries.forEach((entry) => {
                    if (entry.id === undefined) {
                        entry.id = Date.now() + Math.random(); 
                    }
                });

                renderEntries();
                console.log("Log loaded from server successfully.");
            } catch (error) {
                console.error("Could not load log from server. Starting with an empty log.", error);
                logEntries = [];
                renderEntries();
            }
        }

        async function saveEntries() {
            if (SECRET_KEY === "YOUR_JSONBIN_SECRET_KEY_HERE") {
                console.error("JSONBin Secret Key is not set. Log cannot be saved to server.");
                return;
            }

            let dataToSend = logEntries.length > 0 ? logEntries : [PLACEHOLDER_ENTRY];

            try {
                const response = await fetch(API_URL, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-Master-Key': SECRET_KEY },
                    body: JSON.stringify(dataToSend)
                });
                if (!response.ok) {
                    const errorDetails = await response.text();
                    throw new Error(`HTTP error! Status: ${response.status}. Details: ${errorDetails}`);
                }
                console.log("Log saved to server successfully.");
            } catch (error) {
                console.error("Could not save log to server. Error details:", error);
                alert("üö® Warning: Log could not be saved to the central server! Check console for details.");
            }
        }

        async function clearLog() {
            if (SECRET_KEY === "YOUR_JSONBIN_SECRET_KEY_HERE") {
                alert("Cannot clear server log: API key is not configured.");
                return;
            }

            const passwordAttempt = prompt("‚ö†Ô∏è WARNING: This will permanently delete ALL log entries from the SERVER. Please enter the password to confirm:");

            if (passwordAttempt !== CLEAR_PASSWORD) {
                alert("Invalid password. Log clear cancelled.");
                return;
            }

            const originalEntries = [...logEntries];
            const dataToClear = [PLACEHOLDER_ENTRY];

            try {
                const response = await fetch(API_URL, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-Master-Key': SECRET_KEY },
                    body: JSON.stringify(dataToClear)
                });

                if (!response.ok) {
                    const errorDetails = await response.text();
                    throw new Error(`Server PUT failed. Status: ${response.status}. Details: ${errorDetails}`);
                }

                logEntries = [];
                renderEntries();
                alert("‚úÖ Log has been successfully cleared from the server.");

            } catch (error) {
                console.error("Could not clear log on server. Error details:", error);
                logEntries = originalEntries;
                renderEntries();
                alert("üö® FATAL ERROR: Log could not be cleared on the central server! The local log has been restored with the previous data.");
            }
        }

        function clearLogLocal() {
            if (confirm("Are you sure you want to clear the local display? The log data will REMAIN on the server and reload when the page is refreshed.")) {
                entryList.innerHTML = '';
                alert("Local display cleared. Data remains safe on the server. Reloading the page will bring it back.");
            }
        }

        // --- DELETE SELECTED ENTRIES FUNCTION ---
        async function deleteSelectedEntries() {
            const selectedItems = Array.from(entryList.querySelectorAll('li.selected'));
            const idsToDelete = selectedItems.map(li => parseFloat(li.dataset.entryId));

            if (idsToDelete.length === 0) {
                return; // Should be checked by showDeleteConfirmation, but safety check.
            }

            // Filter out the entries that match the IDs to delete
            logEntries = logEntries.filter(entry => !idsToDelete.includes(entry.id));
            
            renderEntries();
            await saveEntries();
            updateDeleteButtonState();
        }
        
        // --- NEW: Click handler to select the whole entry ---
        function handleEntryClick(event) {
            const listItem = event.currentTarget; // The <li> element
            listItem.classList.toggle('selected');
            updateDeleteButtonState();
        }
        
        // --- Update Delete Button State ---
        function updateDeleteButtonState() {
            const selectedCount = entryList.querySelectorAll('li.selected').length;
            if (selectedCount > 0) {
                deleteSelectedBtn.disabled = false;
                deleteSelectedBtn.textContent = `üóëÔ∏è Delete Selected Entries (${selectedCount})`;
            } else {
                deleteSelectedBtn.disabled = true;
                deleteSelectedBtn.textContent = `üóëÔ∏è Delete Selected Entries`;
            }
        }


        // --- UTILITY FUNCTIONS ---

        function getActionClass(action) {
            if (action.includes('Added')) return 'added';
            if (action.includes('Deducted')) return 'deducted';
            if (action.includes('Balance Adjusted')) return 'adjusted';
            return 'other';
        }

        function renderEntries() {
            entryList.innerHTML = '';
            const displayEntries = logEntries.filter(entry => entry.text !== "PLACEHOLDER");

            displayEntries.slice().reverse().forEach(entry => {
                const listItem = document.createElement('li');
                listItem.innerHTML = entry.html;
                listItem.setAttribute('data-search-term', entry.search);
                listItem.setAttribute('data-entry-id', entry.id); // Store ID for click deletion
                listItem.classList.add(entry.actionClass);
                
                // Add the new click handler to the entire list item
                listItem.addEventListener('click', handleEntryClick);

                entryList.appendChild(listItem);
            });
            updateDeleteButtonState();
        }

        function getFormattedDateTime() {
            const now = new Date();
            const dateOptions = { day: '2-digit', month: 'short', year: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit', hour12: true };
            const datePart = now.toLocaleDateString('en-GB', dateOptions);
            const timePart = now.toLocaleTimeString('en-US', timeOptions);
            return `${datePart} at ${timePart}`;
        }

        // --- Event listeners ---
        whatForInput.addEventListener('change', function() {
            if (whatForInput.value === 'Misc') {
                miscReasonInput.style.display = 'block';
                miscReasonInput.focus();
            } else {
                miscReasonInput.style.display = 'none';
                miscReasonInput.value = '';
            }
        });

        actionSelect.addEventListener('change', function() {
            if (actionSelect.value === 'Other Action') {
                otherActionInput.style.display = 'block';
                otherActionInput.focus();
            } else {
                otherActionInput.style.display = 'none';
                otherActionInput.value = '';
            }
        });

        addToListBtn.addEventListener('click', async function() {
            const nameId = nameIdInput.value.trim();
            let whatDid = actionSelect.value;
            const amount = amountInput.value.trim();
            let whatFor = whatForInput.value;
            const timestamp = getFormattedDateTime();

            if (nameId === '' || whatDid === '' || whatDid === '--- Select Action Type ---') {
                alert('Please fill in the Player name and select an Action Type!');
                return;
            }

            if (whatDid === 'Other Action') {
                const otherAction = otherActionInput.value.trim();
                if (otherAction === '') {
                    alert('You selected "Other Action." Please specify the action in the box that appeared.');
                    return;
                }
                whatDid = `Other Action: ${otherAction}`;
            }

            if (amount === '') {
                alert('Please enter an Amount for the transfer!');
                return;
            }

            if (whatFor === '' || whatFor === '--- Select Reason for Points ---') {
                alert('Please select a valid Reason for the points transfer!');
                return;
            }

            if (whatFor === 'Misc') {
                const miscReason = miscReasonInput.value.trim();
                if (miscReason === '') {
                    alert('You selected "Misc Reason." Please specify the reason in the box that appeared.');
                    return;
                }
                whatFor = `Misc: ${miscReason}`;
            }

            const actionClass = getActionClass(actionSelect.value);

            // Generate a truly unique ID for the new entry
            const newEntryId = Date.now() + Math.random();
            
            // --- REDESIGNED HTML FORMAT: MAX VISIBILITY (NO CHECKBOX) ---
            const entryHtml = `
                <div class="log-content">
                    <span class="log-segment log-segment-name"><strong>Player:</strong> ${nameId}</span>
                    <span class="log-segment log-segment-action"><strong>Action:</strong> ${whatDid}</span>
                    <span class="log-segment log-segment-amount"><strong>Amount:</strong> ${amount}</span>
                    <span class="log-segment log-segment-reason"><strong>Reason:</strong> ${whatFor}</span>
                </div>
                <span class="log-timestamp">Logged: ${timestamp}</span>
            `;
            // ----------------------------------------------------

            // TEXT FORMAT FOR DOWNLOAD (.txt) AND CONSOLE 
            const entryText = `${whatDid} | Amount: ${amount} | Player: ${nameId} | Reason: ${whatFor} | Logged: ${timestamp}`;

            const newEntry = {
                id: newEntryId, 
                text: entryText,
                html: entryHtml,
                search: `${nameId.toLowerCase()} ${whatDid.toLowerCase()} ${amount.toLowerCase()} ${whatFor.toLowerCase()}`,
                timestamp: Date.now(),
                actionClass: actionClass
            };

            logEntries.push(newEntry);
            renderEntries();
            await saveEntries();

            // Clear form inputs
            nameIdInput.value = '';
            actionSelect.value = '';
            otherActionInput.value = '';
            otherActionInput.style.display = 'none';
            amountInput.value = '';
            whatForInput.value = '';
            miscReasonInput.value = '';
            miscReasonInput.style.display = 'none';

            alert(`‚úÖ Log entry saved for: ${nameId} (${whatDid} ${amount})`);
        });

        searchBar.addEventListener('keyup', function() {
            const searchTerm = searchBar.value.toLowerCase().trim();
            const listItems = entryList.getElementsByTagName('li');

            Array.from(listItems).forEach(item => {
                const searchData = item.getAttribute('data-search-term');
                if (searchData && searchData.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        });

        downloadLogBtn.addEventListener('click', function() {
            if (logEntries.length === 0) {
                alert("The log is empty!");
                return;
            }

            const logText = logEntries
                .filter(entry => entry.text !== "PLACEHOLDER")
                .map(entry => entry.text)
                .join('\n');

            const filename = `ArkLegendsPVE_PointsLog_${new Date().toISOString().slice(0, 10)}.txt`;
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert("Log download started!");
        });

        clearLogBtn.addEventListener('click', clearLog);
        clearLogLocalBtn.addEventListener('click', clearLogLocal);
        deleteSelectedBtn.addEventListener('click', showDeleteConfirmation); // Button calls modal function

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
             loadEntries();
             // Attach listener to the modal checkbox
             deleteCheckbox.addEventListener('change', toggleModalConfirmButton);
             // Attach global listener to close modal on outside click (optional but good UX)
             window.onclick = function(event) {
                if (event.target === modal) {
                    closeModal();
                }
            }
        });
    </script>
</body>
</html>
